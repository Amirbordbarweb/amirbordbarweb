<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            direction: rtl;
            padding: 50px;
            background-color: #f5f5f5;
            margin: 0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        button {
            padding: 18px 40px;
            font-size: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            background: linear-gradient(135deg, #45a049, #4CAF50);
        }
        button:active {
            transform: translateY(0);
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #message {
            margin-top: 25px;
            padding: 20px;
            border-radius: 10px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            min-height: 100px;
            font-size: 16px;
            line-height: 1.6;
        }
        .status-box {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error {
            color: #d32f2f;
            background-color: #ffebee;
            border-color: #ffcdd2;
        }
        .success {
            color: #388e3c;
            background-color: #e8f5e9;
            border-color: #c8e6c9;
        }
        .warning {
            color: #ff9800;
            background-color: #fff3e0;
            border-color: #ffe0b2;
        }
        .debug-info {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            text-align: left;
            direction: ltr;
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color: #2e7d32;">ğŸ“ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ</h1>
        
        <div class="status-box">
            <p>ğŸ”„ ÙˆØ¶Ø¹ÛŒØª: <span id="status">Ø¢Ù…Ø§Ø¯Ù‡</span></p>
            <p>ğŸ“Š Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡: <span id="count">0</span></p>
        </div>
        
        <button id="getLocationBtn" onclick="getLocation()">
            ğŸ“ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†
        </button>
        
        <div id="message">
            Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ Ø®ÙˆØ¯ØŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ù„Ø§ Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.
        </div>
        
        <div style="margin-top: 30px;">
            <a href="show-location.html" style="
                display: inline-block;
                padding: 12px 25px;
                background-color: #2196F3;
                color: white;
                text-decoration: none;
                border-radius: 8px;
                transition: background-color 0.3s;
            ">
                ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙ…Ø§Ù… Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§
            </a>
        </div>
        
        <div id="debug" class="debug-info" style="display: none;">
            Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯ÛŒØ¨Ø§Ú¯:
        </div>
    </div>

    <script>
        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯ÛŒØ¨Ø§Ú¯
        function debugLog(message) {
            const debugDiv = document.getElementById('debug');
            debugDiv.style.display = 'block';
            debugDiv.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            console.log(message);
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
        function checkBrowserSupport() {
            const supports = {
                geolocation: 'geolocation' in navigator,
                localStorage: 'localStorage' in window,
                indexedDB: 'indexedDB' in window
            };
            
            debugLog(`Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±: ${JSON.stringify(supports)}`);
            
            if (!supports.geolocation) {
                showMessage('Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.', 'error');
                document.getElementById('getLocationBtn').disabled = true;
                return false;
            }
            
            return true;
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        function showMessage(text, type = 'info') {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = text;
            messageDiv.className = type;
            
            debugLog(`Ù¾ÛŒØ§Ù…: ${text}`);
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª
        function updateStatus(text) {
            document.getElementById('status').textContent = text;
        }
        
        // Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª (Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡ Ùˆ Ù…Ø·Ù…Ø¦Ù†)
        function getLocation() {
            debugLog('=== Ø´Ø±ÙˆØ¹ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª ===');
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±
            if (!checkBrowserSupport()) {
                return;
            }
            
            const button = document.getElementById('getLocationBtn');
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...';
            
            updateStatus('Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª...');
            showMessage('Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ² Ù…ÙˆÙ‚Ø¹ÛŒØª...', 'warning');
            
            // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ
            const options = {
                enableHighAccuracy: true,
                timeout: 10000, // 10 Ø«Ø§Ù†ÛŒÙ‡
                maximumAge: 0 // Ù‡Ù…ÛŒØ´Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¬Ø¯ÛŒØ¯
            };
            
            debugLog('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª: ' + JSON.stringify(options));
            
            navigator.geolocation.getCurrentPosition(
                // Ù…ÙˆÙÙ‚ÛŒØª
                async function(position) {
                    debugLog('âœ… Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯');
                    debugLog(`Ù…Ø®ØªØµØ§Øª: ${position.coords.latitude}, ${position.coords.longitude}`);
                    debugLog(`Ø¯Ù‚Øª: ${position.coords.accuracy} Ù…ØªØ±`);
                    
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const acc = position.coords.accuracy;
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
                    updateStatus('Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯');
                    showMessage(`
                        <div style="text-align: center;">
                            <div style="font-size: 24px; color: #4CAF50;">âœ… Ù…ÙˆÙÙ‚ÛŒØª!</div>
                            <div style="margin: 15px 0;">
                                <strong>Ù…Ø®ØªØµØ§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§:</strong><br>
                                <code style="font-size: 18px; background: #f5f5f5; padding: 10px; border-radius: 5px;">
                                    ${lat.toFixed(6)}, ${lng.toFixed(6)}
                                </code>
                            </div>
                            <div>ğŸ¯ Ø¯Ù‚Øª: ${acc.toFixed(2)} Ù…ØªØ±</div>
                        </div>
                    `, 'success');
                    
                    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage (Ø³Ø§Ø¯Ù‡ Ùˆ Ù…Ø·Ù…Ø¦Ù†)
                    try {
                        localStorage.setItem('lastLocation', JSON.stringify({
                            lat: lat,
                            lng: lng,
                            acc: acc,
                            time: new Date().toISOString()
                        }));
                        debugLog('Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                    } catch (e) {
                        debugLog(`Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ localStorage: ${e.message}`);
                    }
                    
                    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± IndexedDB (Ø§Ú¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´ÙˆØ¯)
                    try {
                        await saveToIndexedDB(lat, lng, acc);
                    } catch (e) {
                        debugLog(`Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ IndexedDB: ${e.message}`);
                    }
                    
                    // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡
                    button.disabled = false;
                    button.textContent = 'ğŸ“ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†';
                    
                    // Ù‡Ø¯Ø§ÛŒØª Ø¨Ù‡ ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¹Ø¯ Ø§Ø² 3 Ø«Ø§Ù†ÛŒÙ‡
                    setTimeout(() => {
                        debugLog('Ù‡Ø¯Ø§ÛŒØª Ø¨Ù‡ ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙ‚Ø¹ÛŒØª');
                        window.location.href = "show-location.html";
                    }, 3000);
                },
                
                // Ø®Ø·Ø§
                function(error) {
                    debugLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª: Ú©Ø¯ ${error.code}`);
                    
                    let errorMessage = "Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡";
                    let errorType = 'error';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = "Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø¯ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹:<br>1. Ù…Ø¬ÙˆØ² Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯<br>2. Ø§Ø² HTTPS Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯<br>3. ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯";
                            errorType = 'error';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹:<br>1. GPS Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯<br>2. Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯";
                            errorType = 'warning';
                            break;
                        case error.TIMEOUT:
                            errorMessage = "Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø²Ù…Ø§Ù†â€ŒØ¨Ø± Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.";
                            errorType = 'warning';
                            break;
                    }
                    
                    updateStatus('Ø®Ø·Ø§');
                    showMessage(`<strong>Ø®Ø·Ø§:</strong><br>${errorMessage}`, errorType);
                    
                    // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø§ÛŒ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯
                    button.disabled = false;
                    button.textContent = 'ğŸ”„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯';
                    
                    debugLog('Ø®Ø·Ø§: ' + errorMessage);
                },
                
                options
            );
        }
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± IndexedDB (Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡)
        async function saveToIndexedDB(lat, lng, acc) {
            if (!('indexedDB' in window)) {
                debugLog('IndexedDB Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯');
                return;
            }
            
            try {
                const dbName = "LocationDB";
                const storeName = "locations";
                
                // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                const request = indexedDB.open(dbName, 1);
                
                request.onupgradeneeded = function(event) {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(storeName)) {
                        db.createObjectStore(storeName, { 
                            keyPath: 'id',
                            autoIncrement: true 
                        });
                    }
                };
                
                request.onsuccess = function(event) {
                    const db = event.target.result;
                    const transaction = db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    
                    const locationData = {
                        latitude: lat,
                        longitude: lng,
                        accuracy: acc,
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent
                    };
                    
                    const addRequest = store.add(locationData);
                    
                    addRequest.onsuccess = function() {
                        debugLog('âœ… Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± IndexedDB Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ (ID: ' + addRequest.result + ')');
                        updateLocationCount();
                    };
                    
                    addRequest.onerror = function(e) {
                        debugLog('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ IndexedDB: ' + e.target.error);
                    };
                };
                
                request.onerror = function(event) {
                    debugLog('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† IndexedDB: ' + event.target.error);
                };
                
            } catch (e) {
                debugLog('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ IndexedDB: ' + e.message);
            }
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§
        async function updateLocationCount() {
            if (!('indexedDB' in window)) {
                document.getElementById('count').textContent = '?';
                return;
            }
            
            try {
                const request = indexedDB.open("LocationDB");
                
                request.onsuccess = function(event) {
                    const db = event.target.result;
                    if (db.objectStoreNames.contains("locations")) {
                        const transaction = db.transaction(["locations"], "readonly");
                        const store = transaction.objectStore("locations");
                        const countRequest = store.count();
                        
                        countRequest.onsuccess = function() {
                            document.getElementById('count').textContent = countRequest.result;
                        };
                    }
                };
            } catch (e) {
                // ignore
            }
        }
        
        // ØªØ³Øª Ø§ÙˆÙ„ÛŒÙ‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ
        function testGeolocation() {
            debugLog('=== ØªØ³Øª Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ ===');
            
            if (!navigator.geolocation) {
                debugLog('âŒ geolocation Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯');
                return false;
            }
            
            // ØªØ³Øª Ø³Ø±ÛŒØ¹ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ
            const testOptions = {
                enableHighAccuracy: false,
                timeout: 3000,
                maximumAge: 0
            };
            
            return new Promise((resolve) => {
                navigator.geolocation.getCurrentPosition(
                    () => {
                        debugLog('âœ… ØªØ³Øª Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ù…ÙˆÙÙ‚');
                        resolve(true);
                    },
                    (error) => {
                        debugLog(`âŒ ØªØ³Øª Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚ (Ú©Ø¯: ${error.code})`);
                        resolve(false);
                    },
                    testOptions
                );
            });
        }
        
        // Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø±Ø§ÛŒ Ø±ÙØ¹ Ù…Ø´Ú©Ù„
        function showTroubleshootGuide() {
            const guide = `
                <div style="text-align: right; margin-top: 20px;">
                    <strong>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø±ÙØ¹ Ù…Ø´Ú©Ù„:</strong>
                    <ol style="text-align: right;">
                        <li>Ø§Ø² HTTPS Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ (Ø§Ù„Ø²Ø§Ù…ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ)</li>
                        <li>Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø±ÙˆÛŒ Ù‚ÙÙ„ Ú©Ù†Ø§Ø± Ø¢Ø¯Ø±Ø³ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ â†’ Site settings â†’ Location â†’ Allow</li>
                        <li>Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ GPS Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø±ÙˆØ´Ù† Ø§Ø³Øª</li>
                        <li>ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯</li>
                        <li>Ø§Ø² Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ÛŒ ChromeØŒ Firefox ÛŒØ§ Edge Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯</li>
                    </ol>
                </div>
            `;
            
            showMessage(guide, 'warning');
        }
        
        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ØµÙØ­Ù‡
        window.onload = async function() {
            debugLog('ØµÙØ­Ù‡ Ù„ÙˆØ¯ Ø´Ø¯');
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
            const isSupported = checkBrowserSupport();
            
            if (!isSupported) {
                showTroubleshootGuide();
                return;
            }
            
            // ØªØ³Øª Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ
            const testResult = await testGeolocation();
            
            if (!testResult) {
                showMessage('âš ï¸ Ø§Ù…Ú©Ø§Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±Ø§Ù‡Ù… Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ù…Ø¬ÙˆØ²Ù‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.', 'warning');
                showTroubleshootGuide();
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§
            updateLocationCount();
            
            debugLog('=== Ø¢Ù…Ø§Ø¯Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª ===');
        };
        
        // Ù‡Ù†Ø¯Ù„Ø± Ø®Ø·Ø§Ù‡Ø§ÛŒå…¨å±€
        window.onerror = function(message, source, lineno, colno, error) {
            debugLog(`Ø®Ø·Ø§ÛŒå…¨å±€: ${message} Ø¯Ø± ${source}:${lineno}`);
            console.error(error);
        };
    </script>
</body>
</html>
